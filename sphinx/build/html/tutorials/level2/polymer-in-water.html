<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-W1WGEC5GQ8"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-W1WGEC5GQ8');
    </script>
        <link href="../../_static/favicon-32x32.png" sizes="32x32" rel="icon" type="image/png"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Nanosheared electrolyte" href="nanosheared-electrolyte.html" /><link rel="prev" title="Breaking a carbon nanotube" href="../level1/breaking-a-carbon-nanotube.html" />

    <!-- Generated with Sphinx 7.1.0 and Furo 2023.07.26 -->
        <title>Polymer in water - </title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=362ab14a" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=7e8505bb" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">    </div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">    </span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../miscellaneous/site-walkthrough.html">Site walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../miscellaneous/contact-me.html">Contact me</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Level 0</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../level0/lennard-jones-fluid.html">Lennard Jones fluid</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Level 1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../level1/graphene-under-deformation.html">Graphene under deformation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../level1/breaking-a-carbon-nanotube.html">Breaking a carbon nanotube</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Level 2</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Polymer in water</a></li>
<li class="toctree-l1"><a class="reference internal" href="nanosheared-electrolyte.html">Nanosheared electrolyte</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Level 3</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../level3/water-adsorption-in-silica.html">Water adsorption in silica</a></li>
<li class="toctree-l1"><a class="reference internal" href="../level3/free-energy-calculation.html">Simple free energy calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../level3/reactive-silicon-dioxide.html">Reactive silicon dioxide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extra content</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../miscellaneous/make-gorgeous-image.html">Make gorgeous image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../miscellaneous/use-gromacs-instead.html">Use GROMACS instead</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="polymer-in-water">
<span id="all-atoms-label"></span><h1>Polymer in water<a class="headerlink" href="#polymer-in-water" title="Permalink to this heading">#</a></h1>
<div class="hatnote docutils container">
<p>Solvating a small molecule in water before stretching it</p>
</div>
<figure class="align-right">
<a class="only-dark reference internal image-reference" href="../../_images/main-dark.png"><img alt="peg molecule in water" class="only-dark" src="../../_images/main-dark.png" style="height: 250px;" /></a>
</figure>
<figure class="align-right">
<a class="only-light reference internal image-reference" href="../../_images/main-light.png"><img alt="peg molecule in water" class="only-light" src="../../_images/main-light.png" style="height: 250px;" /></a>
</figure>
<div class="justify docutils container">
<p>The goal of this tutorial is to use LAMMPS and
create a small hydrophilic polymer (PEG -
PolyEthylene Glycol) in a reservoir of water.
An all-atom description is used, therefore all species considered here
are made of charged atoms connected by bonds constraints.</p>
<p>Once the system is created, a constant stretching force will be applied to both
ends of the polymer, and its length will be measured with time.</p>
<p>This tutorial was inspired by a very nice <a href="https://doi.org/10.1021/acsnano.6b07071" target="_blank">publication</a> by Liese and coworkers, in which
they compare MD simulations with force spectroscopy experiments.</p>
</div>
<p>If you are completely new to LAMMPS, I recommend you to follow this simpler tutorial first : <a class="reference internal" href="../level0/lennard-jones-fluid.html#lennard-jones-label"><span class="std std-ref">Lennard Jones fluid</span></a>.</p>
<div class="patreon admonition">
<p class="admonition-title">I provide personal assistance for LAMMPS projects</p>
<p>See the <a class="reference internal" href="../../miscellaneous/contact-me.html#contact-label"><span class="std std-ref">Contact me</span></a> page.</p>
</div>
<section id="bulk-water">
<h2>Bulk water<a class="headerlink" href="#bulk-water" title="Permalink to this heading">#</a></h2>
<div class="justify docutils container">
<p>As a first step, a rectangular box of water is created and
equilibrated at ambient temperature and ambient pressure (the PEG molecule will be added in the next sections).</p>
<p>Create a folder named pureH2O/. Inside this folder, create
an empty text file named input.lammps. Copy the following
lines in it:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pureH2O/input.lammps</em></span><a class="headerlink" href="#id1" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="c"># LAMMPS input script</span>
<span class="k">units</span><span class="w"> </span><span class="n">real</span>
<span class="k">atom_style</span><span class="w"> </span><span class="n">full</span>
<span class="k">bond_style</span><span class="w"> </span><span class="n">harmonic</span>
<span class="k">angle_style</span><span class="w"> </span><span class="n">charmm</span>
<span class="k">dihedral_style</span><span class="w"> </span><span class="n">charmm</span>
<span class="k">pair_style</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">tip4p</span><span class="o">/</span><span class="n">long</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0.105</span><span class="w"> </span><span class="m">12.0</span>
<span class="k">kspace_style</span><span class="w"> </span><span class="n">pppm</span><span class="o">/</span><span class="n">tip4p</span><span class="w"> </span><span class="m">1.0e-4</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>There are many differences with respect to
the previous tutorial (<a class="reference internal" href="../level0/lennard-jones-fluid.html#lennard-jones-label"><span class="std std-ref">Lennard Jones fluid</span></a>), mostly
because here a system with molecules and partial charges is
modeled (instead of neutral particles). With the unit style ‘real’,
masses are in grams per
mole, distances in Ångstroms, time in femtoseconds, energies
in Kcal/mole. With the atom style ‘full’, each atom is a dot
with a mass and a charge. In addition, each atom can be
linked by bonds, angles, dihedrals and impropers potentials
(for example to form molecules). The ‘bond_style’,
‘angle_style’, and ‘dihedral_style’ commands define the
styles of bond angle, and dihedrals used in the simulation,
respectively, and the ‘harmonic’ and ‘charmm’ keywords
impose the type of potential to use.</p>
</div>
<div class="info admonition">
<p class="admonition-title">About the use of charmm style</p>
<p>The future merging of the water with the PEG
has already been anticipated as the charmm angle_style
and dihedral_style are requirements of the PEG’s model.</p>
<p>A rigid water model will be used here, so the bond
and angle styles that are chosen have no consequence on the water model, they will
only matter to the PEG when it is added.</p>
</div>
<div class="justify docutils container">
<p>With the ‘pair_style’ named ‘lj/cut/tip4p/long’, atoms
interact through both a Lennard-Jones (LJ) potential and
through Coulombic interactions. This pair style is specific to
four points water models, and automatically accounts for the
additional massless site. The six numbers are, respectively,</p>
</div>
<ul class="simple">
<li><p><strong>1 -</strong> the atom type for the oxygen O of the tip4p water,</p></li>
<li><p><strong>2 -</strong> the atom type for the hydrogen H of the tip4p water,</p></li>
<li><p><strong>3 -</strong> the OH bond type,</p></li>
<li><p><strong>4 -</strong> the HOH angle type,</p></li>
<li><p><strong>5 -</strong> the distance from O atom to the massless charge (here 0.105 Ångstroms is set by the TIP4P/epsilon water model),</p></li>
<li><p><strong>6 -</strong> the cutoff (here of 12 Ångstroms).</p></li>
</ul>
<div class="info admonition">
<p class="admonition-title">About cutoff in molecular dynamics</p>
<p>The cutoff of 12 Ångstroms applies to both LJ and Coulombic
interactions, but in a different way. For LJ ‘cut’
interactions, atoms interact with each others only if they
are separated by a distance smaller than the cutoff. For
Coulombic ‘long’, interaction between atoms closer than
the cutoff are computed directly, and interaction between
atoms outside that cutoff are computed in the reciprocal
space.</p>
</div>
<div class="justify docutils container">
<p>Finally the kspace command defines the long-range solver for the (long)
Coulombic interactions. The pppm style refers to
particle-particle particle-mesh.</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Background Information (optional) – About PPPM</p>
<p><em>The PPPM
method is based on separating the total interaction
between particles into the sum of short-range
interactions, which are computed by direct
particle-particle summation, and long-range interactions,
which are calculated by solving Poisson’s equation using
periodic boundary conditions (PBCs).</em>
<a href="https://doi.org/10.1021/jp9518623" target="_blank">Luty and van Gunsteren</a></p>
</div>
<div class="justify docutils container">
<p>Then, let us create a 3D simulation box of dimensions 8 x 3
x 3 nm^3, and make space for 7 atom types (1 and 2 for
the water oxygen and hydrogen, respectively, and 3, 4, 5, 6
and 7 for the PEG molecule (see below)), 6 bond types, 9
angle types, and 14 dihedrals types.</p>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pureH2O/input.lammps</em></span><a class="headerlink" href="#id2" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">region </span><span class="nv nv-Identifier">box</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="o">-</span><span class="m">40</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="o">-</span><span class="m">15</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="o">-</span><span class="m">15</span><span class="w"> </span><span class="m">15</span>
<span class="k">create_box</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="o">&amp;</span>
<span class="n">bond</span><span class="o">/</span><span class="n">types</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="o">&amp;</span>
<span class="n">angle</span><span class="o">/</span><span class="n">types</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="o">&amp;</span>
<span class="n">dihedral</span><span class="o">/</span><span class="n">types</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="o">&amp;</span>
<span class="n">extra</span><span class="o">/</span><span class="n">bond</span><span class="o">/</span><span class="n">per</span><span class="o">/</span><span class="n">atom</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">&amp;</span>
<span class="n">extra</span><span class="o">/</span><span class="n">angle</span><span class="o">/</span><span class="n">per</span><span class="o">/</span><span class="n">atom</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;</span>
<span class="n">extra</span><span class="o">/</span><span class="n">special</span><span class="o">/</span><span class="n">per</span><span class="o">/</span><span class="n">atom</span><span class="w"> </span><span class="m">2</span>
</pre></div>
</div>
</div>
<div class="info admonition">
<p class="admonition-title">About extra per atom commands</p>
<p>The extra/[something]/per/atom commands are here for
memory allocation, they ensure that enough space is left for a
certain number of attribute for each atom. We wont worry
about those commands in this tutorial, just keep that in mind if one day you see the following
error message:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ERROR:<span class="w"> </span>Molecule<span class="w"> </span>topology/atom<span class="w"> </span>exceeds<span class="w"> </span>system<span class="w"> </span>topology/atom<span class="w"> </span><span class="o">(</span>src/molecule.cpp:1767<span class="o">)</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Let us include a parameter file containing all the
parameters (masses, interaction energies, bond equilibrium
distances, etc):</p>
</div>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pureH2O/input.lammps</em></span><a class="headerlink" href="#id3" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">include</span><span class="w"> </span><span class="n">..</span><span class="o">/</span><span class="n">PARM.lammps</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Next to the pureH2O/ folder, create a blank file called
PARM.lammps and copy the following lines in it:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in PARM.lammps</em></span><a class="headerlink" href="#id4" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="c"># Mass</span>
<span class="k">mass</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">15.9994</span><span class="w"> </span><span class="c"># H2O O</span>
<span class="k">mass</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1.008</span><span class="w"> </span><span class="c"># H2O H</span>
<span class="k">mass</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">12.011</span><span class="w"> </span><span class="c"># CC32A</span>
<span class="k">mass</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">15.9994</span><span class="w"> </span><span class="c"># OC30A</span>
<span class="k">mass</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1.008</span><span class="w"> </span><span class="c"># HCA2</span>
<span class="k">mass</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">15.9994</span><span class="w"> </span><span class="c"># OC311</span>
<span class="k">mass</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">1.008</span><span class="w"> </span><span class="c"># HCP1</span>

<span class="c"># Pair Coeff</span>
<span class="k">pair_coeff</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0.18479</span><span class="w"> </span><span class="m">3.165</span><span class="w"> </span><span class="c"># H2O - TIP4P - epsilon water model</span>
<span class="k">pair_coeff</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0.0</span><span class="w"> </span><span class="m">0.0</span><span class="w"> </span><span class="c"># H2O H</span>
<span class="k">pair_coeff</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">0.056</span><span class="w"> </span><span class="m">3.58141</span><span class="w"> </span><span class="c"># CC32A</span>
<span class="k">pair_coeff</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">0.100</span><span class="w"> </span><span class="m">2.93997</span><span class="w"> </span><span class="c"># OC30A</span>
<span class="k">pair_coeff</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">0.035</span><span class="w"> </span><span class="m">2.38761</span><span class="w"> </span><span class="c"># HCA2</span>
<span class="k">pair_coeff</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">0.192</span><span class="w"> </span><span class="m">3.14487</span><span class="w"> </span><span class="c"># OC311</span>
<span class="k">pair_coeff</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">0.046</span><span class="w"> </span><span class="m">0.40001</span><span class="w"> </span><span class="c"># HCP1</span>

<span class="c"># Bond coeff</span>
<span class="k">bond_coeff</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0.9572</span><span class="w"> </span><span class="c"># H2O O-H</span>
<span class="k">bond_coeff</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">222.35</span><span class="w"> </span><span class="m">1.5300</span>
<span class="k">bond_coeff</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">308.79</span><span class="w"> </span><span class="m">1.1111</span>
<span class="k">bond_coeff</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">359.76</span><span class="w"> </span><span class="m">1.1415</span>
<span class="k">bond_coeff</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">427.715</span><span class="w"> </span><span class="m">1.1420</span>
<span class="k">bond_coeff</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">544.635</span><span class="w"> </span><span class="m">0.9600</span>

<span class="c"># Angle coeff</span>
<span class="k">angle_coeff</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">104.52</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c"># H2O H-O-H</span>
<span class="k">angle_coeff</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">50.0000</span><span class="w"> </span><span class="m">109.0000</span><span class="w"> </span><span class="m">0.0000</span><span class="w"> </span><span class="m">0.0000</span>
<span class="k">angle_coeff</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">26.5000</span><span class="w"> </span><span class="m">110.1000</span><span class="w"> </span><span class="m">22.5300</span><span class="w"> </span><span class="m">2.179</span>
<span class="k">angle_coeff</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">45.0000</span><span class="w"> </span><span class="m">111.5000</span><span class="w"> </span><span class="m">0.0000</span><span class="w"> </span><span class="m">0.0000</span>
<span class="k">angle_coeff</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">13.0258</span><span class="w"> </span><span class="m">109.4000</span><span class="w"> </span><span class="m">0.0000</span><span class="w"> </span><span class="m">0.0000</span>
<span class="k">angle_coeff</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">35.5000</span><span class="w"> </span><span class="m">109.0000</span><span class="w"> </span><span class="m">5.4000</span><span class="w"> </span><span class="m">1.802</span>
<span class="k">angle_coeff</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">55.0000</span><span class="w"> </span><span class="m">108.8900</span><span class="w"> </span><span class="m">0.0000</span><span class="w"> </span><span class="m">0.0000</span>
<span class="k">angle_coeff</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">75.7000</span><span class="w"> </span><span class="m">110.1000</span><span class="w"> </span><span class="m">0.0000</span><span class="w"> </span><span class="m">0.0000</span>
<span class="k">angle_coeff</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">95.0000</span><span class="w"> </span><span class="m">109.7000</span><span class="w"> </span><span class="m">0.0000</span><span class="w"> </span><span class="m">0.0000</span>

<span class="c"># Dihedral coeff</span>
<span class="k">dihedral_coeff</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0.57</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
<span class="k">dihedral_coeff</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0.29</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
<span class="k">dihedral_coeff</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">0.43</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
<span class="k">dihedral_coeff</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">0.59</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">180</span><span class="w"> </span><span class="m">0</span>
<span class="k">dihedral_coeff</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1.16</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
<span class="k">dihedral_coeff</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">0.12</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
<span class="k">dihedral_coeff</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">0.42</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
<span class="k">dihedral_coeff</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">0.29</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
<span class="k">dihedral_coeff</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">2.87</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">180</span><span class="w"> </span><span class="m">0</span>
<span class="k">dihedral_coeff</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">0.03</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
<span class="k">dihedral_coeff</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">0.23</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
<span class="k">dihedral_coeff</span><span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">1.36</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">180</span><span class="w"> </span><span class="m">0</span>
<span class="k">dihedral_coeff</span><span class="w"> </span><span class="m">13</span><span class="w"> </span><span class="m">0.16</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
<span class="k">dihedral_coeff</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">1.01</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>If you want to know which column refers to which
parameter, you can refer to the LAMMPS documentation. For
this tutorial, we will just trust that these parameters
are correct and will lead to physically consistent
behavior.
Now, let us create water molecules. To do so, let us
define a water molecule using a molecule template called
H2OTip4p.txt, and randomly create 700 of those.</p>
</div>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pureH2O/input.lammps</em></span><a class="headerlink" href="#id5" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">molecule</span><span class="w"> </span><span class="n">h2omol</span><span class="w"> </span><span class="n">H2OTip4p.txt</span>
<span class="k">create_atoms</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="m">700</span><span class="w"> </span><span class="m">456415</span><span class="w"> </span><span class="n">NULL</span><span class="w"> </span><span class="n">mol</span><span class="w"> </span><span class="n">h2omol</span><span class="w"> </span><span class="m">454756</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>The molecule template named H2OTip4p.txt must be <a href="../../../../../inputs/level2/polymer-in-water/pureH2O/H2OTip4p.txt" target="_blank">downloaded</a>
and saved in the same folder (named pureH2O/) as the
input.lammps file. This template contains all the necessary structural
information of a water molecule, such as the number of atoms,
which pair of atoms are connected by bonds, which
groups of atoms are connected by angles, etc.</p>
<p>Then, let us group the atoms of the water in a group named
H2O, and then delete the overlapping molecules:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pureH2O/input.lammps</em></span><a class="headerlink" href="#id6" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">group </span><span class="nv nv-Identifier">H2O</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span>
<span class="k">delete_atoms</span><span class="w"> </span><span class="n">overlap</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="n">H2O</span><span class="w"> </span><span class="n">H2O</span><span class="w"> </span><span class="n">mol</span><span class="w"> </span><span class="n">yes</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Deleting overlapping molecules is required here
because the molecules where placed randomly in space by
the “create_atoms” command, and some of them may be too
close from each other, which may force the simulation to
crash.</p>
<p>The “mol yes” option ensures that entire water molecules are deleted and not just single atoms.</p>
<p>Let us use the shake algorithm in order to constrain the
shape of the water molecules at all time. Let us also use the fix NPT to
control both the temperature and the pressure:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pureH2O/input.lammps</em></span><a class="headerlink" href="#id7" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">fix </span><span class="nv nv-Identifier">myshk</span><span class="w"> </span><span class="nv nv-Identifier">H2O</span><span class="w"> </span><span class="n">shake</span><span class="w"> </span><span class="m">1.0e-5</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="n">mol</span><span class="w"> </span><span class="n">h2omol</span>
<span class="k">fix </span><span class="nv nv-Identifier">mynpt</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">npt</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="m">300</span><span class="w"> </span><span class="m">300</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="n">iso</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1000</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>The parameters of the fix shake specify to
which group (H2O) the shake algorithm applied, with what
tolerance (1e-5). Still in the shake command, we also supply
the molecule template (h2omol) previously defined, and
specify to which bond/angle type shake mush apply, i.e. the
bond of type 1 and the angle of type 1.</p>
<p>The fix NPT allows us to impose both a temperature of 300 K (with a damping constant of 100 fs),
and a pressure of 1 atmosphere (with a damping constant of 1000 fs). With the iso keyword, the
three dimensions of the box will be re-scaled simultaneously, until the average pressure in the system
corresponds to the desired imposed value of 1 atm.</p>
</div>
<div class="info admonition">
<p class="admonition-title">About rigid water model</p>
<p>With shake, water molecules behave as rigid. If
you want to study the vibration of the O-H bonds and
H-O-H angles, you will have to use a flexible water
model. If you want to study the hydrogen transfer, you
will have to use a reactive force field, as done in <a class="reference internal" href="../level3/reactive-silicon-dioxide.html#reactive-silicon-dioxide-label"><span class="std std-ref">Reactive silicon dioxide</span></a>.</p>
</div>
<div class="justify docutils container">
<p>Here only the water molecules will be rigid, the
PEG molecule (which will be added in the next part) will
be fully flexible.</p>
<p>Let us print the atom positions in a dump file every 1000
timesteps (i.e. 1 ps), print the temperature volume, and
density every 100 timesteps in 3 separate data files, and
print the information in the terminal every 1000 timesteps:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pureH2O/input.lammps</em></span><a class="headerlink" href="#id8" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">dump </span><span class="nv nv-Identifier">mydmp</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">atom</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="n">dump.lammpstrj</span>
<span class="k">variable </span><span class="nv nv-Identifier">mytemp</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="n">temp</span>
<span class="k">variable </span><span class="nv nv-Identifier">myvol</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="n">vol</span>
<span class="k">fix </span><span class="nv nv-Identifier">myat1</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">ave</span><span class="o">/</span><span class="n">time</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="n">v_mytemp</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">temperature.dat</span>
<span class="k">fix </span><span class="nv nv-Identifier">myat2</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">ave</span><span class="o">/</span><span class="n">time</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="n">v_myvol</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">volume.dat</span>
<span class="k">variable </span><span class="nv nv-Identifier">myoxy</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="n">count</span><span class="nv">(H2O)</span><span class="o">/</span><span class="m">3</span><span class="w"> </span><span class="c"># divide by 3 to get the number of molecule, not atom</span>
<span class="k">variable </span><span class="nv nv-Identifier">mydensity</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="nv">${myoxy}</span><span class="o">/</span><span class="n">v_myvol</span>
<span class="k">fix </span><span class="nv nv-Identifier">myat3</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">ave</span><span class="o">/</span><span class="n">time</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="n">v_mydensity</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">density.dat</span>
<span class="k">thermo</span><span class="w"> </span><span class="m">1000</span>
</pre></div>
</div>
</div>
<div class="info admonition">
<p class="admonition-title">The difference between ${var} and v_var</p>
<p>Both ${var} and v_var can be used to call a previously defined variable named var.
However, ${var} returns the initial value of var, while v_var returns the instantaneous
value of var.</p>
</div>
<div class="justify docutils container">
<p>In the formula for the density (number of
molecule divided by volume), the underscore ‘_’ is used to
call myvol because the volume is expected
to evolve in time when using fix NPT, but the dollar sign ‘$’ is used to call myoxy as the
number of molecules is not expected to evolve during the
simulation. Note that the number of molecule changes after the
delete_atoms command is used, but this is done only before the
simulation starts.
Finally, let us set the timestep to 2.0 fs, and run the simulation for 50 ps:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pureH2O/input.lammps</em></span><a class="headerlink" href="#id9" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">timestep</span><span class="w"> </span><span class="m">2.0</span>
<span class="k">run</span><span class="w"> </span><span class="m">25000</span>
<span class="k">write_data</span><span class="w"> </span><span class="n">H2O.data</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Looking at the log file, one can see how many atoms have
been deleted (the number will vary depending on the random
number you choose).</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>Deleted 714 atoms, new total = 1386
Deleted 476 bonds, new total = 924
Deleted 238 angles, new total = 462
</pre></div>
</div>
<div class="justify docutils container">
<p>About 30 % the molecules were deleted due to overlapping,
together with their respective bonds and angles.
At the end of the simulation, the final state is printed
in the H2O.data file, which will be used later.</p>
</div>
<div class="info admonition">
<p class="admonition-title">Running LAMMPS in parallel</p>
<p>This simulation may be a bit slow to complete on 1 single core.
You can speed it up by running LAMMPS on 2, 4 or even more cores, by typing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun<span class="w"> </span>-np<span class="w"> </span><span class="m">4</span><span class="w"> </span>lmp<span class="w"> </span>-in<span class="w"> </span>input.lammps
</pre></div>
</div>
<p>Here 4 core are used. The command may vary, depending on your OS and LAMMPS installation.</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Background Information (optional) – Choosing the right number of cores</p>
<p>When running a simulation in parallel using more than one CPU core, LAMMPS divides the system into
blocks, and each core is assigned to a given block. Here, as can be seen from the terminal, when using ‘mpirun -np 4’, LAMMPS divides
the system into 4 blocks along the x axis:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Created<span class="w"> </span>orthogonal<span class="w"> </span><span class="nv">box</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>-40.000000<span class="w"> </span>-15.000000<span class="w"> </span>-15.000000<span class="o">)</span><span class="w"> </span>to<span class="w"> </span><span class="o">(</span><span class="m">40</span>.000000<span class="w"> </span><span class="m">15</span>.000000<span class="w"> </span><span class="m">15</span>.000000<span class="o">)</span>
<span class="w"> </span><span class="m">4</span><span class="w"> </span>by<span class="w"> </span><span class="m">1</span><span class="w"> </span>by<span class="w"> </span><span class="m">1</span><span class="w"> </span>MPI<span class="w"> </span>processor<span class="w"> </span>grid
</pre></div>
</div>
<p>You can force LAMMPS to divide the system differently, let us say along both y and z axis,
by using the command</p>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">processors</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span>
</pre></div>
</div>
<p>However, communication between the different cores slows down the computation, so ideally you want
to minimize the size of the surface between domains. Here the default choice of LAMMPS (i.e. processors 4 1 1)
is certainly a better choice.</p>
<p>If you don’t know what is the best number of processors or the best way to cut the system, just perform
a short simulation and look at the log file. For instance, if I run the simulation on 1 core I get :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Performance:<span class="w"> </span><span class="m">31</span>.567<span class="w"> </span>ns/day,<span class="w"> </span><span class="m">0</span>.760<span class="w"> </span>hours/ns,<span class="w"> </span><span class="m">182</span>.680<span class="w"> </span>timesteps/s
</pre></div>
</div>
<p>On 4 cores (keeping the default processors 4 1 1):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Performance:<span class="w"> </span><span class="m">109</span>.631<span class="w"> </span>ns/day,<span class="w"> </span><span class="m">0</span>.219<span class="w"> </span>hours/ns,<span class="w"> </span><span class="m">634</span>.440<span class="w"> </span>timesteps/s
</pre></div>
</div>
<p>This is much faster, but this is not 4 times faster, because of the cost of communicating between processors.</p>
<p>On 4 cores and enforcing the stupid choice: processors 1 2 2, I get</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Performance:<span class="w"> </span><span class="m">99</span>.864<span class="w"> </span>ns/day,<span class="w"> </span><span class="m">0</span>.240<span class="w"> </span>hours/ns,<span class="w"> </span><span class="m">577</span>.919<span class="w"> </span>timesteps/s
</pre></div>
</div>
<p>Its not so bad but still not at good as 4 1 1.</p>
<p>On 8 cores (the max I got), I get :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">4</span><span class="w"> </span>by<span class="w"> </span><span class="m">1</span><span class="w"> </span>by<span class="w"> </span><span class="m">2</span><span class="w"> </span>MPI<span class="w"> </span>processor<span class="w"> </span>grid

...

Performance:<span class="w"> </span><span class="m">152</span>.106<span class="w"> </span>ns/day,<span class="w"> </span><span class="m">0</span>.158<span class="w"> </span>hours/ns,<span class="w"> </span><span class="m">880</span>.243<span class="w"> </span>timesteps/s
</pre></div>
</div>
<p>So LAMMPS chooses to divide the system once along z, and 4 times along x, and the speed is improved, but again the improvement
is not linear with the number of cores.</p>
<p><strong>Choose carefully the best number of cores for your simulation so that you don’t waste computational resource.
Sometimes it is better to run 2 simulations on 2 cores each than 1 simulation on 4 cores.</strong></p>
</div>
<div class="justify docutils container">
<p>Note that no energy minimization was performed here (NPT
molecular dynamics was started straight away). This is a
bit risky, but it works here because overlapping
molecules were deleted, and because the initial density
is very low.</p>
<p>If you open the dump.lammpstrj file using VMD, you should
see the system reaching its equilibrium volume:</p>
</div>
<figure class="align-default">
<img alt="Bulk water system" class="only-light" src="../../_images/water_light.webp" />
</figure>
<figure class="align-default" id="id10">
<img alt="Bulk water system" class="only-dark" src="../../_images/water_dark.webp" />
<figcaption>
<p><span class="caption-text">Video: water molecules during NPT equilibration.</span><a class="headerlink" href="#id10" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="justify docutils container">
<p>You can also open the temperature.dat and density.dat files
to ensure that the system converged toward an equilibrated
liquid system during the 50 ps of simulation:</p>
</div>
<figure class="align-default">
<img alt="Curves showing the equilibration of the water reservoir" class="only-light" src="../../_images/equilibration_H2O_light.png" />
</figure>
<figure class="align-default" id="id11">
<img alt="Curves showing the equilibration of the water reservoir" class="only-dark" src="../../_images/equilibration_H2O_dark.png" />
<figcaption>
<p><span class="caption-text">The graph on the left shows the evolution of the temperature
with time, and the graph on the right the evolution of the
density.</span><a class="headerlink" href="#id11" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="justify docutils container">
<p>Alternatively, you can <a href="../../../../../inputs/level2/polymer-in-water/pureH2O/H2O.data" target="_blank">download</a>
the water reservoir I have equilibrated and continue with
the tutorial.</p>
</div>
<div class="patreon admonition">
<p class="admonition-title">Support me for 1 euro per month</p>
<p>Become a <a href="https://www.patreon.com/molecularsimulations" target="_blank">Patreon</a> and support the creation of content for LAMMPS</p>
</div>
</section>
<section id="peg-molecule">
<h2>PEG molecule<a class="headerlink" href="#peg-molecule" title="Permalink to this heading">#</a></h2>
<div class="justify docutils container">
<p>Now that the water box is ready, let us prepare the PEG
molecule in an empty box. Create a second folder next to pureH2O/, call it
singlePEG/, and create a new blank file called input.lammps
in it. Copy the same first lines as previously:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in singlePEG/input.lammps</em></span><a class="headerlink" href="#id12" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">units</span><span class="w"> </span><span class="n">real</span>
<span class="k">atom_style</span><span class="w"> </span><span class="n">full</span>
<span class="k">bond_style</span><span class="w"> </span><span class="n">harmonic</span>
<span class="k">angle_style</span><span class="w"> </span><span class="n">charmm</span>
<span class="k">dihedral_style</span><span class="w"> </span><span class="n">charmm</span>
<span class="k">pair_style</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">tip4p</span><span class="o">/</span><span class="n">long</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0.105</span><span class="w"> </span><span class="m">12.0</span>
<span class="k">kspace_style</span><span class="w"> </span><span class="n">pppm</span><span class="o">/</span><span class="n">tip4p</span><span class="w"> </span><span class="m">1.0e-4</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Let us also add the special_bonds command to cancel the
Lennard-Jones interactions between the closest
atoms of a same molecule:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in singlePEG/input.lammps</em></span><a class="headerlink" href="#id13" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">special_bonds</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">coul</span><span class="w"> </span><span class="m">0.0</span><span class="w"> </span><span class="m">0.0</span><span class="w"> </span><span class="m">0.5</span>
</pre></div>
</div>
</div>
<div class="info admonition">
<p class="admonition-title">About special_bonds</p>
<p>Usually, force fields like charmm are parametrized assuming that the first neighbors within a molecule do not
interact directly. Here, since we use 0.0 0.0 0.5, the first (for example C-O) and second (for example C-O-H) neighbors don’t interact
with each other through LJ and Coulomb potentials, and therefore they only interact through direct bond interactions.
For the third neighbor (for example H-C-C-H), only half of the LJ and Coulomb interaction will be added.</p>
</div>
<div class="justify docutils container">
<p>Let us read the original positions for the atoms of the PEG molecule, as
well as the same parameter file as previously:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in singlePEG/input.lammps</em></span><a class="headerlink" href="#id14" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">read_data</span><span class="w"> </span><span class="n">init.data</span>
<span class="k">include</span><span class="w"> </span><span class="n">..</span><span class="o">/</span><span class="n">PARM.lammps</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p><a href="../../../../../inputs/level2/polymer-in-water/singlePEG/init.data" target="_blank">Download</a>
the init.data file and save it in the singlePEG/ folder.
It contains the initial parameters of the PEG molecules
(atoms, bonds, charges, etc.) that was prepared using <a href="https://github.com/simongravelle/PEGgenerator" target="_blank">PEG generator</a>.
To make our life simpler later, let use use the exact same
box size for the PEG as for the water (the merging will be
simpler, see below). Open the previously generate H2O.data
file, and copy the 3 lines corresponding to the box
dimensions. In my case, its:</p>
</div>
<div class="highlight-bw notranslate"><div class="highlight"><pre><span></span>-21.64201909795004 21.64201909795004 xlo xhi
-8.115757161731125 8.115757161731125 ylo yhi
-8.115757161731125 8.115757161731125 zlo zhi
</pre></div>
</div>
<div class="justify docutils container">
<p>Then, replace the box dimensions in the init.data file with
these 3 lines.</p>
<p>Let us print the atom positions and thermodynamic
information very frequently (because we anticipate that the
energy minimization will be short):</p>
</div>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in singlePEG/input.lammps</em></span><a class="headerlink" href="#id15" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">dump </span><span class="nv nv-Identifier">mydmp</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">atom</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="n">dump.lammpstrj</span>
<span class="k">thermo</span><span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Next, let us perform a minimisation of energy. Here, this
step is required because the initial configuration of the
PEG molecule is really far from equilibrium.</p>
</div>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in singlePEG/input.lammps</em></span><a class="headerlink" href="#id16" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">minimize</span><span class="w"> </span><span class="m">1.0e-4</span><span class="w"> </span><span class="m">1.0e-6</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">1000</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>After the minimisation, the high resolution dump command is
cancelled, and a new dump command with lower frequency is
used (see below). We also reset the time to 0 with
reset_timestep command:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in singlePEG/input.lammps</em></span><a class="headerlink" href="#id17" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">undump </span><span class="nv nv-Identifier">mydmp</span>
<span class="k">reset_timestep</span><span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>The PEG is then equilibrated in the NVT ensemble (fix NVE +
temperature control = NVT). No box relaxation is required as
the PEG is in vacuum:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in singlePEG/input.lammps</em></span><a class="headerlink" href="#id18" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">fix </span><span class="nv nv-Identifier">mynve</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">nve</span>
<span class="k">fix </span><span class="nv nv-Identifier">myber</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">temp</span><span class="o">/</span><span class="n">berendsen</span><span class="w"> </span><span class="m">300</span><span class="w"> </span><span class="m">300</span><span class="w"> </span><span class="m">100</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Let us print the temperature in a file:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in singlePEG/input.lammps</em></span><a class="headerlink" href="#id19" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">dump </span><span class="nv nv-Identifier">mydmp</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">atom</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="n">dump.lammpstrj</span>
<span class="k">dump_modify</span><span class="w"> </span><span class="n">mydmp</span><span class="w"> </span><span class="n">append</span><span class="w"> </span><span class="n">yes</span>
<span class="k">thermo</span><span class="w"> </span><span class="m">1000</span>
<span class="k">variable </span><span class="nv nv-Identifier">mytemp</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="n">temp</span>
<span class="k">fix </span><span class="nv nv-Identifier">myat1</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">ave</span><span class="o">/</span><span class="n">time</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="n">v_mytemp</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">temperature.dat</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>The <em>dump_modify</em> ensures that the coordinates are written
in the existing dump.lammpstrj file.
Finally let us run the simulation for a very short time (10 ps):</p>
</div>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in singlePEG/input.lammps</em></span><a class="headerlink" href="#id20" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">timestep</span><span class="w"> </span><span class="m">1</span>
<span class="k">run</span><span class="w"> </span><span class="m">10000</span>
<span class="k">write_data</span><span class="w"> </span><span class="n">PEG.data</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>If you open the dump.lammpstrj file
using VMD, you can see the PEG molecule starting from
an extremely elongated and unrealistic shape, and
gently equilibrating until reaching a reasonable state.</p>
</div>
<figure class="align-default">
<img alt="PEG in vacuum" class="only-light" src="../../_images/singlePEG-light.webp" />
</figure>
<figure class="align-default" id="id21">
<img alt="PEG in vacuum" class="only-dark" src="../../_images/singlePEG-dark.webp" />
<figcaption>
<p><span class="caption-text">The PEG molecule in vacuum during an energy
minimisation step, followed by a short NVT molecular dynamics.
The carbon atoms are in dark, the oxygen atoms in red, and the hydrogen atoms in white.</span><a class="headerlink" href="#id21" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="justify docutils container">
<p>Alternatively, you can <a href="../../../../../inputs/level2/polymer-in-water/singlePEG/PEG.data" target="_blank">download</a>
the PEG molecule I have equilibrated and continue with the tutorial.</p>
</div>
</section>
<section id="solvation-of-the-peg-molecule">
<h2>Solvation of the PEG molecule<a class="headerlink" href="#solvation-of-the-peg-molecule" title="Permalink to this heading">#</a></h2>
<div class="justify docutils container">
<p>Now, we merge the PEG molecule and the
water reservoir. We do it by:</p>
<ul class="simple">
<li><ol class="arabic simple">
<li><p>importing both previously generated data files (PEG.data and H2O.data) into the same simulation,</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="2">
<li><p>deleting the overlapping molecules, and</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="3">
<li><p>re-equilibrating the new system.</p></li>
</ol>
</li>
</ul>
<p>Create a third folder alongside pureH2O/ and singlePEG/,
and call it mergePEGH2O/. Create a new blank file in it,
called input.lammps. Within input.lammps, copy the same first lines as
previously:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in mergePEGH2O/input.lammps</em></span><a class="headerlink" href="#id22" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">units</span><span class="w"> </span><span class="n">real</span>
<span class="k">atom_style</span><span class="w"> </span><span class="n">full</span>
<span class="k">bond_style</span><span class="w"> </span><span class="n">harmonic</span>
<span class="k">angle_style</span><span class="w"> </span><span class="n">charmm</span>
<span class="k">dihedral_style</span><span class="w"> </span><span class="n">charmm</span>
<span class="k">pair_style</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">tip4p</span><span class="o">/</span><span class="n">long</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0.105</span><span class="w"> </span><span class="m">12.0</span>
<span class="k">kspace_style</span><span class="w"> </span><span class="n">pppm</span><span class="o">/</span><span class="n">tip4p</span><span class="w"> </span><span class="m">1.0e-4</span>
<span class="k">special_bonds</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">coul</span><span class="w"> </span><span class="m">0.0</span><span class="w"> </span><span class="m">0.0</span><span class="w"> </span><span class="m">0.5</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Then, import the two previously generated data files, as well as the same parameter file:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in mergePEGH2O/input.lammps</em></span><a class="headerlink" href="#id23" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">read_data</span><span class="w"> </span><span class="n">..</span><span class="o">/</span><span class="n">singlePEG</span><span class="o">/</span><span class="n">PEG.data</span>
<span class="k">read_data</span><span class="w"> </span><span class="n">..</span><span class="o">/</span><span class="n">pureH2O</span><span class="o">/</span><span class="n">H2O.data</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">append</span>
<span class="k">include</span><span class="w"> </span><span class="n">..</span><span class="o">/</span><span class="n">PARM.lammps</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>When using the read_data command more than once, one needs
to use the <em>add append</em> keyword. When doing so, the
simulation box is initialized by the first read_data only, and the
second read_data only imports additional atoms.
Let us create 2 groups to differentiate the PEG from the H2O:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in mergePEGH2O/input.lammps</em></span><a class="headerlink" href="#id24" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">group </span><span class="nv nv-Identifier">H2O</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span>
<span class="k">group </span><span class="nv nv-Identifier">PEG</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Water molecules that are overlapping with the PEG must be
deleted to avoid crashing:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id25">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in mergePEGH2O/input.lammps</em></span><a class="headerlink" href="#id25" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">delete_atoms</span><span class="w"> </span><span class="n">overlap</span><span class="w"> </span><span class="m">2.0</span><span class="w"> </span><span class="n">H2O</span><span class="w"> </span><span class="n">PEG</span><span class="w"> </span><span class="n">mol</span><span class="w"> </span><span class="n">yes</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Here the value of 2 Angstroms for the overlap cutoff was fixed arbitrarily,
and can be chosen through trial and error. If the cutoff is too small, the
simulation will crash. If the cutoff it too long, too many water molecules will unnecessarily be deleted.</p>
<p>Finally, let us use shake to keep the water
molecules rigid, and use the NPT command to control the
temperature, as well as the pressure along the x axis:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id26">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in mergePEGH2O/input.lammps</em></span><a class="headerlink" href="#id26" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">fix </span><span class="nv nv-Identifier">myshk</span><span class="w"> </span><span class="nv nv-Identifier">H2O</span><span class="w"> </span><span class="n">shake</span><span class="w"> </span><span class="m">1.0e-4</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="m">1</span>
<span class="k">fix </span><span class="nv nv-Identifier">mynpt</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">npt</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="m">300</span><span class="w"> </span><span class="m">300</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1000</span>
<span class="k">timestep</span><span class="w"> </span><span class="m">1.0</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>The box dimension will only adjust along the x axis here.</p>
<p>Once more, let us dump the atom positions and a few
information about the evolution simulation:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id27">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in mergePEGH2O/input.lammps</em></span><a class="headerlink" href="#id27" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">dump </span><span class="nv nv-Identifier">mydmp</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">atom</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="n">dump.lammpstrj</span>
<span class="k">thermo</span><span class="w"> </span><span class="m">100</span>
<span class="k">variable </span><span class="nv nv-Identifier">mytemp</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="n">temp</span>
<span class="k">variable </span><span class="nv nv-Identifier">myvol</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="n">vol</span>
<span class="k">fix </span><span class="nv nv-Identifier">myat1</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">ave</span><span class="o">/</span><span class="n">time</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="n">v_mytemp</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">temperature.dat</span>
<span class="k">fix </span><span class="nv nv-Identifier">myat2</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">ave</span><span class="o">/</span><span class="n">time</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="n">v_myvol</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">volume.dat</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Let us also print the total enthalpy:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id28">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in mergePEGH2O/input.lammps</em></span><a class="headerlink" href="#id28" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">variable </span><span class="nv nv-Identifier">myenthalpy</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="n">enthalpy</span>
<span class="k">fix </span><span class="nv nv-Identifier">myat3</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">ave</span><span class="o">/</span><span class="n">time</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="n">v_myenthalpy</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">enthalpy.dat</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Finally, let us perform a short equilibration and print the
final state in a data file:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id29">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in mergePEGH2O/input.lammps</em></span><a class="headerlink" href="#id29" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">run</span><span class="w"> </span><span class="m">10000</span>
<span class="k">write_data</span><span class="w"> </span><span class="n">mix.data</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>If you open the dump.lammpstrj file using VMD, you should
see that the box dimension slightly shrink along x.
The system looks like that:</p>
</div>
<figure class="align-default">
<img alt="PEG in water" class="only-light" src="../../_images/solvatedPEG_light.png" />
</figure>
<figure class="align-default" id="id30">
<img alt="PEG in water" class="only-dark" src="../../_images/solvatedPEG_dark.png" />
<figcaption>
<p><span class="caption-text">PEG molecule in water. Water is represented as a continuous field for clarity.</span><a class="headerlink" href="#id30" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="stretching-the-peg-molecule">
<h2>Stretching the PEG molecule<a class="headerlink" href="#stretching-the-peg-molecule" title="Permalink to this heading">#</a></h2>
<div class="justify docutils container">
<p>Here, a constant forcing is applied to the two ends of the
PEG molecule until it stretches. Create a new folder next
to the 3 previously created folders, call it pullonPEG/
and create a new input file in it called input.lammps.
First, let us create a variable containing the magnitude
of the force we are going to apply. The force magnitude is
chosen to be large enough to overcome the thermal
agitation and the entropic contribution from both water
and PEG molecules (it was chosen by trial and error). Copy
in the input file:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id31">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pullonPEG/input.lammps</em></span><a class="headerlink" href="#id31" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">variable </span><span class="nv nv-Identifier">f0</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c"># kcal/mol/A # 1 kcal/mol/A = 67.2 pN</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Then, as previouly, copy:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id32">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pullonPEG/input.lammps</em></span><a class="headerlink" href="#id32" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">units</span><span class="w"> </span><span class="n">real</span>
<span class="k">atom_style</span><span class="w"> </span><span class="n">full</span>
<span class="k">bond_style</span><span class="w"> </span><span class="n">harmonic</span>
<span class="k">angle_style</span><span class="w"> </span><span class="n">charmm</span>
<span class="k">dihedral_style</span><span class="w"> </span><span class="n">charmm</span>
<span class="k">pair_style</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">cut</span><span class="o">/</span><span class="n">tip4p</span><span class="o">/</span><span class="n">long</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0.105</span><span class="w"> </span><span class="m">12.0</span>
<span class="k">kspace_style</span><span class="w"> </span><span class="n">pppm</span><span class="o">/</span><span class="n">tip4p</span><span class="w"> </span><span class="m">1.0e-4</span>
<span class="k">special_bonds</span><span class="w"> </span><span class="n">lj</span><span class="o">/</span><span class="n">coul</span><span class="w"> </span><span class="m">0.0</span><span class="w"> </span><span class="m">0.0</span><span class="w"> </span><span class="m">0.5</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Start the simulation from the equilibrated PEG + water
system, and include again the parameters:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id33">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pullonPEG/input.lammps</em></span><a class="headerlink" href="#id33" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">read_data</span><span class="w"> </span><span class="n">..</span><span class="o">/</span><span class="n">mergePEGH2O</span><span class="o">/</span><span class="n">mix.data</span>
<span class="k">include</span><span class="w"> </span><span class="n">..</span><span class="o">/</span><span class="n">PARM.lammps</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Then, let us create 4 atom groups: H2O and PEG (as
previously) as well as 2 groups containing one single atom
corresponding respectively to the oxygen atoms located at the
ends of the PEG molecule:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id34">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pullonPEG/input.lammps</em></span><a class="headerlink" href="#id34" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">group </span><span class="nv nv-Identifier">H2O</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span>
<span class="k">group </span><span class="nv nv-Identifier">PEG</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span>
<span class="k">group </span><span class="nv nv-Identifier">oxygen_end1</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="m">65</span>
<span class="k">group </span><span class="nv nv-Identifier">oxygen_end2</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="m">4</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Let us print again the atom positions in a dump:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id35">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pullonPEG/input.lammps</em></span><a class="headerlink" href="#id35" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">dump </span><span class="nv nv-Identifier">mydmp</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">atom</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="n">dump.lammpstrj</span>
<span class="c"># write_dump all atom dump.lammpstrj</span>
<span class="c"># dump myxtc xtc atom 1000 dump.xtc</span>
</pre></div>
</div>
</div>
<div class="info admonition">
<p class="admonition-title">Use less disk space by using the xtc format</p>
<p>To generate smaller dump files, use the
compressed xtc format. You can do it by commenting the
mydmp line and by uncommenting both the write_dump and
myxtc lines. Note that xtc files are compressed, and not readable
by humans, contrarily to the LAMMPS native format lammpstrj.</p>
</div>
<div class="justify docutils container">
<p>Let us use a simple thermostating for all atoms
and use shake for the rigid water molecules:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id36">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pullonPEG/input.lammps</em></span><a class="headerlink" href="#id36" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">timestep</span><span class="w"> </span><span class="m">1</span>
<span class="k">fix </span><span class="nv nv-Identifier">myshk</span><span class="w"> </span><span class="nv nv-Identifier">H2O</span><span class="w"> </span><span class="n">shake</span><span class="w"> </span><span class="m">1.0e-4</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="m">1</span>
<span class="k">fix </span><span class="nv nv-Identifier">mynvt</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">nvt</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="m">300</span><span class="w"> </span><span class="m">300</span><span class="w"> </span><span class="m">100</span>
</pre></div>
</div>
</div>
<p>Let us print the end-to-end distance of the PEG (and the
temperature of the entire system):</p>
<div class="literal-block-wrapper docutils container" id="id37">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pullonPEG/input.lammps</em></span><a class="headerlink" href="#id37" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">variable </span><span class="nv nv-Identifier">mytemp</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="n">temp</span>
<span class="k">fix </span><span class="nv nv-Identifier">myat1</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">ave</span><span class="o">/</span><span class="n">time</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="n">v_mytemp</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">temperature.dat</span>
<span class="k">variable </span><span class="nv nv-Identifier">x1</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="n">xcm</span><span class="nv">(oxygen_end1,x)</span>
<span class="k">variable </span><span class="nv nv-Identifier">x2</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="n">xcm</span><span class="nv">(oxygen_end2,x)</span>
<span class="k">variable </span><span class="nv nv-Identifier">delta_x</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="n">abs</span><span class="nv">(v_x1-v_x2)</span>
<span class="k">fix </span><span class="nv nv-Identifier">myat2</span><span class="w"> </span><span class="nv nv-Identifier">all</span><span class="w"> </span><span class="n">ave</span><span class="o">/</span><span class="n">time</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="n">v_delta_x</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">end</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">end</span><span class="o">-</span><span class="n">distance.dat</span>
<span class="k">thermo</span><span class="w"> </span><span class="m">5000</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Finally, let us run the simulation for 10 ps (without
any external forcing):</p>
</div>
<div class="literal-block-wrapper docutils container" id="id38">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pullonPEG/input.lammps</em></span><a class="headerlink" href="#id38" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">run</span><span class="w"> </span><span class="m">10000</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>This 10 ps serves as an extra small equilibration. In principle,
it is not necessary as equilibration was properly performed during the
previous step. Then, let us apply a forcing on the 2 oxygen atoms using 2
add_force commands, and run for 100 ps (for a total duration
of the simulation of 110 ps):</p>
</div>
<div class="literal-block-wrapper docutils container" id="id39">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in pullonPEG/input.lammps</em></span><a class="headerlink" href="#id39" title="Permalink to this code">#</a></div>
<div class="highlight-lammps notranslate"><div class="highlight"><pre><span></span><span class="k">fix </span><span class="nv nv-Identifier">myaf1</span><span class="w"> </span><span class="nv nv-Identifier">oxygen_end1</span><span class="w"> </span><span class="n">addforce</span><span class="w"> </span><span class="nv">${f0}</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
<span class="k">fix </span><span class="nv nv-Identifier">myaf2</span><span class="w"> </span><span class="nv nv-Identifier">oxygen_end2</span><span class="w"> </span><span class="n">addforce</span><span class="w"> </span><span class="o">-</span><span class="nv">${f0}</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
<span class="k">run</span><span class="w"> </span><span class="m">50000</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>If you open the dump.lammpstrj file using VMD, you should
see this:</p>
</div>
<figure class="align-default">
<img alt="PEG molecule in water" class="only-dark" src="../../_images/pulled_peg_dark.png" />
</figure>
<figure class="align-default" id="id40">
<img alt="PEG molecule in water" class="only-light" src="../../_images/pulled_peg_light.png" />
<figcaption>
<p><span class="caption-text">PEG molecule streched in water. Water is represented as a continuous field for clarity.</span><a class="headerlink" href="#id40" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="justify docutils container">
<p>The evolution of the end-to-end
distance over time shows the PEG adjusting
to the external forcing:</p>
</div>
<figure class="align-default">
<img alt="plot of the end-to-end distance versus time" class="only-dark" src="../../_images/distance-dark.png" />
</figure>
<figure class="align-default" id="id41">
<img alt="plot of the end-to-end distance versus time" class="only-light" src="../../_images/distance-light.png" />
<figcaption>
<p><span class="caption-text">Evolution of the end-to-end distance of the PEG molecule
with time. The forcing starts at <span class="math notranslate nohighlight">\(t = 10\)</span> ps.</span><a class="headerlink" href="#id41" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>You can access all the input scripts and data files that
are used in these tutorials from <a href="https://github.com/lammpstutorials/lammpstutorials.github.io/tree/version2.0/docs/inputs" target="_blank">Github</a>.</p>
</section>
<section id="what-now">
<h2>What now?<a class="headerlink" href="#what-now" title="Permalink to this heading">#</a></h2>
<div class="justify docutils container">
<p>Now that you have completed this relatively advanced molecular dynamics tutorials, and
that all input scripts are working, I suggest you to mess around with the inputs and
try to trigger warnings and error. The more warning and error you trigger from a working input, the
easier it will be to solve future issue in your own input.</p>
</div>
</section>
<section id="going-further-with-exercises">
<h2>Going further with exercises<a class="headerlink" href="#going-further-with-exercises" title="Permalink to this heading">#</a></h2>
<div class="solution admonition">
<p class="admonition-title">Solutions</p>
<p>Register as a <a href="https://www.patreon.com/molecularsimulations" target="_blank">Patreon</a> for 1 euro/month
to access all the solutions.</p>
</div>
<section id="generate-a-peg-h2o-mixture">
<h3>Generate a PEG-H2O mixture<a class="headerlink" href="#generate-a-peg-h2o-mixture" title="Permalink to this heading">#</a></h3>
<div class="justify docutils container">
<p>Use the same script and a similar procedure and create a
PEG-H2O mixture with several PEG molecules hydrated in a
cubic box.</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Hints</p>
<p>LAMMPS has internal commands allowing to replicate
a molecule or a system.</p>
<p>There is no obligation to equilibrate the water molecules separately from the PEG,
as we did here. You can also create the water molecules directly around the PEG molcule
using the create_atom command.</p>
</div>
</section>
<section id="end-to-end-distance">
<h3>End-to-end distance<a class="headerlink" href="#end-to-end-distance" title="Permalink to this heading">#</a></h3>
<div class="justify docutils container">
<p>Create 2 simulations, one with a PEG molecule in vacuum, one
with a PEG molecule in water, and measure their respective
end-to-end equilibrium distance. PEG are hydrophilic and
form hbonds with water molecules, therefore, when immersed
in water, PEG molecules slightly unfold, which changes the
equilibrium end-to-end distance.</p>
</div>
</section>
<section id="post-mortem-analysis">
<h3>Post-mortem analysis<a class="headerlink" href="#post-mortem-analysis" title="Permalink to this heading">#</a></h3>
<div class="justify docutils container">
<p>In today research, most data analyses are
done after the simulation is over, and it is important for
LAMMPS users to know how to do it.</p>
<p>Import the trajectory using Python, and re-extract the
end-to-end distance.</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Hints</p>
<p>You can import lammpstrj file using MDAnalysis:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="s2">&quot;dump.lammpstrj&quot;</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;LAMMPSDUMP&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="nanosheared-electrolyte.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Nanosheared electrolyte</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../level1/breaking-a-carbon-nanotube.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Breaking a carbon nanotube</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Polymer in water</a><ul>
<li><a class="reference internal" href="#bulk-water">Bulk water</a></li>
<li><a class="reference internal" href="#peg-molecule">PEG molecule</a></li>
<li><a class="reference internal" href="#solvation-of-the-peg-molecule">Solvation of the PEG molecule</a></li>
<li><a class="reference internal" href="#stretching-the-peg-molecule">Stretching the PEG molecule</a></li>
<li><a class="reference internal" href="#what-now">What now?</a></li>
<li><a class="reference internal" href="#going-further-with-exercises">Going further with exercises</a><ul>
<li><a class="reference internal" href="#generate-a-peg-h2o-mixture">Generate a PEG-H2O mixture</a></li>
<li><a class="reference internal" href="#end-to-end-distance">End-to-end distance</a></li>
<li><a class="reference internal" href="#post-mortem-analysis">Post-mortem analysis</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/scripts/furo.js?v=32e29ea5"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>