<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Deforming silicon dioxide" href="../reaxff/reax-silica.html" /><link rel="prev" title="Simple free energy calculation" href="umbrella-sampling.html" />

    <!-- Generated with Sphinx 6.1.3 and Furo 2022.12.07 -->
        <title>Adsorption of ethanol - </title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">    </div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">    </span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Main</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../howto.html">How-to</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bulk fluids</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bulkfluids/lennardjones.html">Lennard Jones fluid</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bulkfluids/allatoms.html">Polymer in water</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bulkfluids/sheared.html">Nanosheared electrolyte</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">2D materials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../2Dmaterials/graphene.html">Graphene under deformation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2Dmaterials/carbonnanotube.html">Breaking a carbon nanotube</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Monte Carlo</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../montecarlo/gcmc-silica.html">Water adsorption in silica</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Free energy</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="umbrella-sampling.html">Simple free energy calculation</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Adsorption of ethanol</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reaxff [new]</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reaxff/reax-silica.html">Deforming silicon dioxide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extra content</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contact/contact.html">Contact me</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../history/history.html">Quick history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../miscellaneous/vmd.html">VMD tips</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="adsorption-of-ethanol">
<span id="surface-profile-label"></span><h1>Adsorption of ethanol<a class="headerlink" href="#adsorption-of-ethanol" title="Permalink to this heading">#</a></h1>
<div class="justify docutils container">
<p>This tutorial is part of the <em>Free energy</em> series.</p>
</div>
<div class="hatnote docutils container">
<p>Free energy profile of ethanol near a solid surface</p>
</div>
<figure class="align-right">
<a class="only-light reference internal image-reference" href="../../_images/avatar-light.png"><img alt="Figure showing ethanol molecules adsorbed at the NaCl(100) surface." class="only-light" src="../../_images/avatar-light.png" style="height: 250px;" /></a>
</figure>
<figure class="align-right">
<a class="only-dark reference internal image-reference" href="../../_images/avatar-dark.png"><img alt="Figure showing ethanol molecules adsorbed at the NaCl(100) surface." class="only-dark" src="../../_images/avatar-dark.png" style="height: 250px;" /></a>
</figure>
<div class="justify docutils container">
<p>The objective of this tutorial is to build a molecular
dynamics system made of a flat crystal wall (NaCl) and
ethanol molecules. The molecule topology files will be downloaded from
the <a class="reference external" href="https://atb.uq.edu.au/">ATB repository</a>.</p>
</div>
<section id="download-atb-molecule">
<h2>Download ATB molecule<a class="headerlink" href="#download-atb-molecule" title="Permalink to this heading">#</a></h2>
<div class="justify docutils container">
<p>We first need to download the molecule structure and force
field information from the Automated Topology Builder (ATB)
and repository.</p>
<p>Create a EthanolMolecule/ folder.</p>
<p>Alternatively, you can skip the creation of the system and go directly to
the <a class="reference external" href="#equilibrium">molecular dynamics</a> part by
downloading the input data file
<a class="reference external" href="../../../../../inputs/freeenergy/SurfaceProfile/data.lammps">here</a>.</p>
<p>Go to the <a class="reference external" href="https://atb.uq.edu.au/">ATB
repository</a> website (you will
need to register). Then go to Existing Molecules, choose a
molecule. I am choosing an <a class="reference external" href="https://atb.uq.edu.au/molecule.py?molid=514352#panel-md">ethanol
molecule</a>,
but you can choose another one (at your own risk) and follow
this tutorial. Then, click on Molecular Dynamics (MD) Files,
choose LAMMPS format, and download the
<a class="reference external" href="../../../../../inputs/freeenergy/SurfaceProfile/EthanolMolecule/GROMOS_54A7_ATB.lt">GROMOS force field</a>
and the
<a class="reference external" href="../../../../../inputs/freeenergy/SurfaceProfile/EthanolMolecule/JRA4_allatom_optimized_geometry.lt">all-atom moltemplate</a>
files into the EthanolMolecule/ folder.</p>
<p>Inside the moltemplate file, there is an example of
`system.lt` allowing for the creation of LAMMPS input
file. Copy past it, and create a
<a class="reference external" href="../../../../../inputs/freeenergy/SurfaceProfile/EthanolMolecule/system.lt">system.lt</a>
file that looks like that:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># system.lt</span>
<span class="c1"># simulation of a single molecule in a box of size 50x50x50 Angstroms^3</span>

write_once<span class="o">(</span><span class="s2">&quot;Data Boundary&quot;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
-25.0<span class="w"> </span><span class="m">25</span>.0<span class="w"> </span>xlo<span class="w"> </span>xhi
-25.0<span class="w"> </span><span class="m">25</span>.0<span class="w"> </span>ylo<span class="w"> </span>yhi
-25.0<span class="w"> </span><span class="m">25</span>.0<span class="w"> </span>zlo<span class="w"> </span>zhi
<span class="o">}</span>

write_once<span class="o">(</span><span class="s2">&quot;In Init&quot;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="c1"># a variable named `cutoff` is required by GROMOS_54A7_ATB.lt</span>
variable<span class="w"> </span>cutoff<span class="w"> </span>equal<span class="w"> </span><span class="m">14</span>.0<span class="w"> </span><span class="c1"># Angstroms</span>
boundary<span class="w"> </span>p<span class="w"> </span>p<span class="w"> </span>p
<span class="o">}</span>

<span class="c1"># import the forcefield file</span>
import<span class="w"> </span><span class="s2">&quot;GROMOS_54A7_ATB.lt&quot;</span>
<span class="c1"># import molecule building block file</span>
import<span class="w"> </span><span class="s2">&quot;JRA4_allatom_optimized_geometry.lt&quot;</span>

<span class="c1"># create a single copy of this molecule at position 0,0,0</span>
<span class="nv">mol1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>new<span class="w"> </span>JRA4.move<span class="o">(</span><span class="m">0</span>.0,0.0,0.0<span class="o">)</span>
</pre></div>
</div>
<div class="justify docutils container">
<p>Run it using <a class="reference external" href="https://www.moltemplate.org/">Moltemplate</a>,</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>moltemplate.sh<span class="w"> </span>./system.lt
</pre></div>
</div>
<div class="justify docutils container">
<p>to generate several LAMMPS input files corresponding to a
single molecule in vacuum, which you can run using LAMMPS:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lmp<span class="w"> </span>-in<span class="w"> </span>run.in.EXAMPLE
</pre></div>
</div>
<div class="justify docutils container">
<p>The files generated by moltemplate contain all bonds, angles, etc.,
information of the <em>entire</em> force field, which makes it unpleasant to
read.</p>
<p>Let us arrange the data and isolate only the useful
information. Create four files, named
<a class="reference external" href="../../../../../inputs/freeenergy/SurfaceProfile/EthanolMolecule/Positions.dat">Positions.dat</a>,
<a class="reference external" href="../../../../../inputs/freeenergy/SurfaceProfile/EthanolMolecule/Bonds.dat">Bonds.dat</a>,
<a class="reference external" href="../../../../../inputs/freeenergy/SurfaceProfile/EthanolMolecule/Angles.dat">Angles.dat</a>, and
<a class="reference external" href="../../../../../inputs/freeenergy/SurfaceProfile/EthanolMolecule/Dihedrals.dat">Dihedrals.dat</a>,
Then re-number the atoms
types, bonds, angles starting from 1.</p>
<p>For the ethanol molecule, the
<a class="reference external" href="../../../../../inputs/freeenergy/SurfaceProfile/EthanolMolecule/Bonds.dat">Bonds.dat</a>
file looks like that:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span>
<span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span>
<span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span>
<span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span>
<span class="m">5</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span>
<span class="m">6</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span>
<span class="m">7</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">8</span>
<span class="m">8</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">9</span>
</pre></div>
</div>
<div class="justify docutils container">
<p>The first column is the bond index, going from 1 to 8 (8 is
the number of bond for the Ethanol molecule), the second
column is the identity of the bond. For each bond identity,
a bond length and energy are given:</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bond_coeff<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">349</span>.274<span class="w"> </span><span class="m">1</span>.0900
bond_coeff<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">399</span>.792<span class="w"> </span><span class="m">1</span>.4300
bond_coeff<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">299</span>.844<span class="w"> </span><span class="m">1</span>.5200
bond_coeff<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">349</span>.928<span class="w"> </span><span class="m">1</span>.1000
bond_coeff<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">442</span>.161<span class="w"> </span><span class="m">0</span>.9720
</pre></div>
</div>
<div class="justify docutils container">
<p>The third and fourth columns of the Bonds.dat file are the
indexes of the atoms linked together by a bond.</p>
<p>Sorting out these files is a tedious task, to continue to follow this
tutorial, you can download these files for ethanol
(<a class="reference external" href="../../../../../inputs/freeenergy/SurfaceProfile/EthanolMolecule/Positions.dat">Positions.dat</a>,
<a class="reference external" href="../../../../../inputs/freeenergy/SurfaceProfile/EthanolMolecule/Bonds.dat">Bonds.dat</a>,
<a class="reference external" href="../../../../../inputs/freeenergy/SurfaceProfile/EthanolMolecule/Angles.dat">Angles.dat</a>, and
<a class="reference external" href="../../../../../inputs/freeenergy/SurfaceProfile/EthanolMolecule/Dihedrals.dat">Dihedrals.dat</a>).
Alternatively, you can use <a class="reference external" href="https://github.com/simongravelle/atb2lammps">the
atb2lammps</a>
code to create a clean initial configuration.</p>
<p>If you choose another molecule, you may have additional
impropers contraints, or may not have dihedral constraints. In that
case you will have to make a few adjustment to the following codes.</p>
</div>
</section>
<section id="initial-configuration">
<h2>Initial configuration<a class="headerlink" href="#initial-configuration" title="Permalink to this heading">#</a></h2>
<div class="justify docutils container">
<p>Here we replicate the ethanol molecule in between two crystal
walls made of NaCl. Next to the EthanolMolecule/ folder, create another
folder named NaCl/, and create a file named Positions.dat in it.
Copy the following lines corresponding to the initial
positions of 8 NaCl atoms:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in NaCl/Positions.dat</em></span><a class="headerlink" href="#id1" title="Permalink to this code">#</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span>.<span class="w"> </span><span class="m">0</span>.<span class="w"> </span><span class="m">0</span>.
<span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>-1<span class="w"> </span><span class="m">0</span>.<span class="w"> </span><span class="m">2</span>.84<span class="w"> </span><span class="m">0</span>.
<span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>-1<span class="w"> </span><span class="m">2</span>.84<span class="w"> </span><span class="m">0</span>.<span class="w"> </span><span class="m">0</span>.
<span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span>.84<span class="w"> </span><span class="m">2</span>.84<span class="w"> </span><span class="m">0</span>.
<span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>-1<span class="w"> </span><span class="m">0</span>.<span class="w"> </span><span class="m">0</span>.<span class="w"> </span><span class="m">2</span>.84
<span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span>.<span class="w"> </span><span class="m">2</span>.84<span class="w"> </span><span class="m">2</span>.84
<span class="m">7</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span>.84<span class="w"> </span><span class="m">0</span>.<span class="w"> </span><span class="m">2</span>.84
<span class="m">8</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>-1<span class="w"> </span><span class="m">2</span>.84<span class="w"> </span><span class="m">2</span>.84<span class="w"> </span><span class="m">2</span>.84
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Then, download this
<a class="reference external" href="../../../../../inputs/freeenergy/SurfaceProfile/generatedata.py">Python script</a>,
next to the EthanolMolecule/ and NaCl/ folders, and run it using</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>generatedata.py
</pre></div>
</div>
<div class="justify docutils container">
<p>to generate the data.lammps file containing the initial
configuration. This home-made Python script reads the
position and molecule information for both NaCl and ethanol,
replicate them, and write a LAMMPS data file. Feel free to
modify it and add more molecules (or a different molecule).</p>
<p>To properly insert molecules within a structure using a
custom script, it is important to detect the positions of
the neighbor atoms before inserting a molecule, otherwise
atoms will overlap and LAMMPS will crash.</p>
<p>The present Python script rotates the molecules to give them
a random orientation, this step is not really necessary as a
short molecular dynamics simulation would randomize the
molecule orientation anyway.</p>
<p>Let us create a parameter
file, named PARM.lammps, which contains all the mass and intra/inter
molecular interaction parameters:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in PARM.lammps</em></span><a class="headerlink" href="#id2" title="Permalink to this code">#</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># mass parameters</span>
mass<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">22</span>.99000
mass<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">35</span>.45000
mass<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">12</span>.011
mass<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">1</span>.008
mass<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span>.008
mass<span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">12</span>.011
mass<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">15</span>.9994
<span class="c1"># pair coeffs</span>
pair_coeff<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span>.0552<span class="w"> </span><span class="m">2</span>.31
pair_coeff<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span>.1004<span class="w"> </span><span class="m">4</span>.3
pair_coeff<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">0</span>.0663<span class="w"> </span><span class="m">3</span>.5812
pair_coeff<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">0</span>.0281<span class="w"> </span><span class="m">2</span>.3734
pair_coeff<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">0</span>.0000<span class="w"> </span><span class="m">0</span>.0000
pair_coeff<span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">0</span>.2450<span class="w"> </span><span class="m">2</span>.8114
pair_coeff<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">0</span>.1195<span class="w"> </span><span class="m">3</span>.1000
<span class="c1"># bond coeffs</span>
bond_coeff<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">349</span>.274<span class="w"> </span><span class="m">1</span>.0900
bond_coeff<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">399</span>.792<span class="w"> </span><span class="m">1</span>.4300
bond_coeff<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">299</span>.844<span class="w"> </span><span class="m">1</span>.5200
bond_coeff<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">349</span>.928<span class="w"> </span><span class="m">1</span>.1000
bond_coeff<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">442</span>.161<span class="w"> </span><span class="m">0</span>.9720
<span class="c1"># angle coeffs</span>
angle_coeff<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">47</span>.694<span class="w"> </span><span class="m">109</span>.500
angle_coeff<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">55</span>.127<span class="w"> </span><span class="m">109</span>.500
angle_coeff<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">55</span>.114<span class="w"> </span><span class="m">111</span>.000
angle_coeff<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">52</span>.477<span class="w"> </span><span class="m">107</span>.570
angle_coeff<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">47</span>.502<span class="w"> </span><span class="m">108</span>.530
angle_coeff<span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">54</span>.993<span class="w"> </span><span class="m">110</span>.300
<span class="c1"># dihedral coeffs</span>
dihedral_coeff<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span>.30115<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span>
dihedral_coeff<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span>.415<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span>
dihedral_coeff<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span>
dihedral_coeff<span class="w">  </span><span class="m">3</span><span class="w"> </span><span class="m">0</span>.0<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>Here, atoms of type 1 and 2 are Na and Cl, and atoms 3 to 7 are
the different hydrogen, oxygen, and carbon atoms of the
ethanol molecules.</p>
<p>All the force field values for the ethanol come from
the ATB, and from the GROMOS force field. The force field
values for NaCl have been taken from <a class="reference external" href="https://pubs.acs.org/doi/10.1021/acs.jpcb.1c05303">this
paper</a>
by Loche et al. The interaction parameters between atoms of
types i and j will be calculated by LAMMPS using the arithmetic rule.</p>
</div>
</section>
<section id="equilibrium">
<h2>Equilibrium<a class="headerlink" href="#equilibrium" title="Permalink to this heading">#</a></h2>
<div class="justify docutils container">
<p>Using LAMMPS, let us bring the system to equilibrium. Open a
new text file, name it input.eq.lammps, and copy the
following lines in it:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in input.eq.lammps</em></span><a class="headerlink" href="#id3" title="Permalink to this code">#</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ethanol at a nacl surface</span>
<span class="c1"># variables</span>
variable<span class="w"> </span>pre<span class="w"> </span>equal<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1"># desired pressure (Atm)</span>
variable<span class="w"> </span>tem<span class="w"> </span>equal<span class="w"> </span><span class="m">300</span><span class="w"> </span><span class="c1"># desired temperature (K)</span>
<span class="c1"># main parameters</span>
units<span class="w"> </span>real<span class="w"> </span><span class="c1"># style of units (A, fs, Kcal/mol)</span>
atom_style<span class="w"> </span>full<span class="w"> </span><span class="c1"># molecular + charge</span>
bond_style<span class="w"> </span>harmonic
angle_style<span class="w"> </span>harmonic
dihedral_style<span class="w"> </span>harmonic
boundary<span class="w"> </span>p<span class="w"> </span>p<span class="w"> </span>p<span class="w"> </span><span class="c1"># periodic boundary conditions</span>
pair_style<span class="w"> </span>lj/cut/coul/long<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c1"># cut-off 1 nm</span>
kspace_style<span class="w"> </span>pppm<span class="w"> </span><span class="m">1</span>.0e-4
pair_modify<span class="w"> </span>mix<span class="w"> </span>arithmetic<span class="w"> </span>tail<span class="w"> </span>yes<span class="w"> </span><span class="c1"># eij = sqrt(ei*ej), dij = 0.5*(di+dj)</span>
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>The script starts with the definition of two variables:
temperature and pressure. Then, units are defined, as well
as atom, bond, angle, and dihedral styles. Periodic boundary
conditions are used in all directions of space. Atoms
interact through a Lennard-Jones potential with a cut off at
1 nm, as well as through long-range Coulomb interactions
using the particle-particle particle-mesh solver with an
accuracy of 0.0001. Finally, the arithmetic rule is used to
control interaction between atoms of different types.</p>
<p>Then, add the following lines to the script:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in input.eq.lammps</em></span><a class="headerlink" href="#id4" title="Permalink to this code">#</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># import positions and parameters</span>
read_data<span class="w"> </span>data.lammps
include<span class="w"> </span>PARM.lammps
<span class="c1"># groups # descriptions</span>
group<span class="w"> </span>nacl<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="c1"># nacl wall</span>
group<span class="w"> </span>eth<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="c1"># ethanol molecules</span>
<span class="c1"># dynamics</span>
timestep<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1"># (fs)</span>
fix<span class="w"> </span>mymme<span class="w"> </span>nacl<span class="w"> </span>momentum<span class="w"> </span><span class="m">1</span><span class="w"> </span>linear<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span>
velocity<span class="w"> </span>all<span class="w"> </span>create<span class="w"> </span><span class="si">${</span><span class="nv">tem</span><span class="si">}</span><span class="w"> </span><span class="m">4928459</span><span class="w"> </span>rot<span class="w"> </span>yes<span class="w"> </span>mom<span class="w"> </span>yes<span class="w"> </span>dist<span class="w"> </span>gaussian
fix<span class="w"> </span>mynpt<span class="w"> </span>all<span class="w"> </span>npt<span class="w"> </span>temp<span class="w"> </span><span class="si">${</span><span class="nv">tem</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">tem</span><span class="si">}</span><span class="w"> </span><span class="m">100</span><span class="w"> </span>x<span class="w"> </span><span class="si">${</span><span class="nv">pre</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">pre</span><span class="si">}</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span>y<span class="w"> </span><span class="si">${</span><span class="nv">pre</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">pre</span><span class="si">}</span><span class="w"> </span><span class="m">1000</span>
<span class="c1"># output</span>
thermo<span class="w"> </span><span class="m">1000</span>
dump<span class="w"> </span>dp1<span class="w"> </span>all<span class="w"> </span>atom<span class="w"> </span><span class="m">1000</span><span class="w"> </span>dump.lammpstrj<span class="w"> </span><span class="c1"># print every 1 ps</span>
<span class="c1"># run</span>
run<span class="w"> </span><span class="m">100000</span><span class="w"> </span><span class="c1"># 100 ps</span>
write_data<span class="w"> </span>eq.data
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>The read_data and include commands are used to import the
previously generated data and parameter files, respectively.
Then, two groups are defined from the atoms types, and a
timestep of 1 fs is set. The linear momentum of the NaCl
block is canceled in all three directions to avoid drifting.
Initial velocities are given to the atoms , with a starting
temperature equal to the chosen value of 300 K. An
anisotropic NPT thermostat is used, with the volume being
adjusted only along the <em>x</em> and <em>y</em> directions, and
not along the <em>z</em> direction to avoid the collapse of the two walls.</p>
<p>Trajectories are printed in a dump file every 1 ps, and
information to the terminal every 1 ps. The simulation runs
for 100 ps and finally the final state is printed in the
eq.data file. You can visualize the trajectory by opening
the dump file using VMD.</p>
</div>
</section>
<section id="umbrella-sampling">
<h2>Umbrella sampling<a class="headerlink" href="#umbrella-sampling" title="Permalink to this heading">#</a></h2>
<div class="justify docutils container">
<p>From the previously equilibrated configuration, let us
perform the umbrella sampling simulation step. To do so, we
are going to pick one of the ethanol molecule, and force it
to move along an axis normal to the NaCl surface by adding
a harmonic potential to it. The actual position of the
molecule around the center of the harmonic potential will be
recorded, and used later to reconstruct the free energy
profile.</p>
<p>Create another input file, call it
input.umbrella.lammps, and copy the following lines in it:</p>
</div>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><em>to be copied in input.umbrella.lammps</em></span><a class="headerlink" href="#id5" title="Permalink to this code">#</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ethanol at a nacl surface</span>
<span class="c1"># variables</span>
variable<span class="w"> </span>pre<span class="w"> </span>equal<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1"># desired pressure (Atm)</span>
variable<span class="w"> </span>tem<span class="w"> </span>equal<span class="w"> </span><span class="m">300</span><span class="w"> </span><span class="c1"># desired temperature (K)</span>
variable<span class="w"> </span>k1<span class="w"> </span>equal<span class="w"> </span><span class="m">0</span>.5<span class="w"> </span><span class="c1"># spring constant</span>
variable<span class="w"> </span>k2<span class="w"> </span>equal<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c1"># spring constant</span>
<span class="c1"># main parameters</span>
units<span class="w"> </span>real<span class="w"> </span><span class="c1"># style of units (A, fs, Kcal/mol)</span>
atom_style<span class="w"> </span>full<span class="w"> </span><span class="c1"># molecular + charge</span>
bond_style<span class="w"> </span>harmonic
angle_style<span class="w"> </span>harmonic
dihedral_style<span class="w"> </span>harmonic
boundary<span class="w"> </span>p<span class="w"> </span>p<span class="w"> </span>p<span class="w"> </span><span class="c1"># periodic boundary conditions</span>
pair_style<span class="w"> </span>lj/cut/coul/long<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c1"># cut-off 1 nm</span>
kspace_style<span class="w"> </span>pppm<span class="w"> </span><span class="m">1</span>.0e-4
pair_modify<span class="w"> </span>mix<span class="w"> </span>arithmetic<span class="w"> </span>tail<span class="w"> </span>yes<span class="w"> </span><span class="c1"># eij = sqrt(ei*ej), dij = 0.5*(di+dj)</span>
<span class="c1"># import positions and parameters</span>
read_data<span class="w"> </span>data.npt
include<span class="w"> </span>PARM.lammps
<span class="c1"># groups # descriptions</span>
group<span class="w"> </span>nacl<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="c1"># nacl wall</span>
group<span class="w"> </span>eth<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="c1"># ethanol molecules</span>
group<span class="w"> </span>oxy<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="c1"># ethanol molecules</span>
group<span class="w"> </span>mol2<span class="w"> </span>molecule<span class="w"> </span><span class="m">2</span>
group<span class="w"> </span>topull<span class="w"> </span>intersect<span class="w"> </span>mol2<span class="w"> </span>oxy
<span class="c1"># dynamics</span>
timestep<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1"># (fs)</span>
fix<span class="w"> </span>mynve<span class="w"> </span>all<span class="w"> </span>nve
fix<span class="w"> </span>mylgv<span class="w"> </span>all<span class="w"> </span>langevin<span class="w"> </span><span class="si">${</span><span class="nv">tem</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">tem</span><span class="si">}</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="m">1530917</span>
variable<span class="w"> </span>zini<span class="w"> </span>equal<span class="w"> </span>xcm<span class="o">(</span>nacl,z<span class="o">)</span>
fix<span class="w"> </span>mytth1<span class="w"> </span>nacl<span class="w"> </span>spring<span class="w"> </span>tether<span class="w"> </span><span class="si">${</span><span class="nv">k2</span><span class="si">}</span><span class="w"> </span>NULL<span class="w"> </span>NULL<span class="w"> </span><span class="si">${</span><span class="nv">zini</span><span class="si">}</span><span class="w"> </span><span class="m">0</span>
<span class="c1"># output</span>
thermo<span class="w"> </span><span class="m">1000</span>
dump<span class="w"> </span>dp1<span class="w"> </span>all<span class="w"> </span>atom<span class="w"> </span><span class="m">50000</span><span class="w"> </span>dump.lammpstrj
<span class="c1"># run</span>
variable<span class="w"> </span>zave<span class="w"> </span>equal<span class="w"> </span>xcm<span class="o">(</span>topull,z<span class="o">)</span>
variable<span class="w"> </span>cpt<span class="w"> </span>loop<span class="w"> </span><span class="m">24</span>
label<span class="w"> </span>loop
variable<span class="w"> </span>zdes<span class="w"> </span>equal<span class="w"> </span>-20+0.5*<span class="o">(</span><span class="si">${</span><span class="nv">cpt</span><span class="si">}</span>-1<span class="o">)</span>
fix<span class="w"> </span>mytth2<span class="w"> </span>topull<span class="w"> </span>spring<span class="w"> </span>tether<span class="w"> </span><span class="si">${</span><span class="nv">k1</span><span class="si">}</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="si">${</span><span class="nv">zdes</span><span class="si">}</span><span class="w"> </span><span class="m">0</span>
run<span class="w"> </span><span class="m">50000</span>
fix<span class="w"> </span>myat1<span class="w"> </span>all<span class="w"> </span>ave/time<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="m">2000</span><span class="w"> </span>v_zave<span class="w"> </span>v_zdes<span class="w"> </span>file<span class="w"> </span>position.<span class="si">${</span><span class="nv">cpt</span><span class="si">}</span>.dat
run<span class="w"> </span><span class="m">500000</span>
unfix<span class="w"> </span>myat1
next<span class="w"> </span>cpt
jump<span class="w"> </span>SELF<span class="w"> </span>loop
</pre></div>
</div>
</div>
<div class="justify docutils container">
<p>The first difference between this script and the previous
one is the definition of two spring constants <span class="math notranslate nohighlight">\(k_1\)</span> and
<span class="math notranslate nohighlight">\(k_2\)</span> that will be used respectively to maintain the
ethanol molecule, and the nacl wall near given positions. A
second difference is that new groups have been defined, with
the group ‘topull’ being made of one single oxygen atom that
is part of the chosen ethanol molecule. This group is itself
build from the intersection between the group ‘oxy’ made of
all the oxygen atoms of type 7, and the group ‘mol2’ made of
all the atoms of the molecule of index 2 (the wall is index
1, and the ethanol molecules are indexes 2, 3, 4 etc.).
Finally, a loop made of 24 iterations is defined, the
variable <em>zdes</em> is the desired position we want to impose to
the atom of group <em>topull</em>, it goes from -20 Å (very close
to the bottom wall) to -8 Å (far from the wall). The fix
<em>mytth2</em> is used to add the harmonic potential to the atom
<em>topull</em>. Note that the fix <em>mytth1</em> is used to prevent the
NaCl wall for drifting from its original position <em>zini</em>.</p>
<p>Another important difference with the previous step is the use here
of a Langevin thermostat, which provides better sampling. Some other
thermostats can lead to the molecules oscillating continuously within its
trapping potential.</p>
<p>Run the script using LAMMPS. 24 files named position.1.dat,
position.2.dat… position.24.dat must appear inside the folder.
The simulation will take time.</p>
<p>If you visualize the dump file with VMD, you see one molecule being
progressively moved out from the wall. The other molecules
remain unperturbed by the additional harmonic potential and free to diffuse and adsorb.</p>
</div>
</section>
<section id="building-the-free-energy-profile">
<h2>Building the free energy profile<a class="headerlink" href="#building-the-free-energy-profile" title="Permalink to this heading">#</a></h2>
<div class="justify docutils container">
<p>In order to treat the data, we are going to use the WHAM
algorithm. You can download and compile the version of <a class="reference external" href="http://membrane.urmc.rochester.edu/?page_id=126">Alan
Grossfield</a>.
In order to apply the WHAM algorithm to our simulation, we
first need to create a metadata file. This file simply
contains the paths of the data file, the value of
<span class="math notranslate nohighlight">\(x_\text{des}\)</span>, and the values of <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span>. To generate
the file more easily, you can run this script using Octave
(assuming that the wham algorithm is located in the same
folder as the LAMMPS simulations).</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">file</span><span class="o">=</span>fopen<span class="o">(</span><span class="s1">&#39;metadata.dat&#39;</span>,<span class="s1">&#39;wt&#39;</span><span class="o">)</span><span class="p">;</span>
<span class="k">for</span><span class="w"> </span><span class="nv">a</span><span class="o">=</span><span class="m">1</span>:24
<span class="w">    </span><span class="nv">X</span><span class="o">=[</span><span class="s1">&#39;./position.&#39;</span>,num2str<span class="o">(</span>a<span class="o">)</span>,<span class="s1">&#39;.dat &#39;</span>,num2str<span class="o">(</span>-20+0.5*<span class="o">(</span>a-1<span class="o">))</span>,<span class="s1">&#39; 0.5&#39;</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span>fprintf<span class="o">(</span>file,X<span class="o">)</span><span class="p">;</span>
<span class="w">    </span>fprintf<span class="o">(</span>file,<span class="s1">&#39;\n&#39;</span><span class="o">)</span><span class="p">;</span>
end
</pre></div>
</div>
<div class="justify docutils container">
<p>The generated file named metadata.dat looks like that
(alternatively you can download it
<a class="reference external" href="../../../../../inputs/freeenergy/SurfaceProfile/metadata.dat">here</a>):</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./position.1.dat<span class="w"> </span>-99<span class="w"> </span><span class="m">0</span>.0205
./position.1.dat<span class="w"> </span>-20<span class="w"> </span><span class="m">0</span>.5
./position.2.dat<span class="w"> </span>-19.5<span class="w"> </span><span class="m">0</span>.5
./position.3.dat<span class="w"> </span>-19<span class="w"> </span><span class="m">0</span>.5
./position.4.dat<span class="w"> </span>-18.5<span class="w"> </span><span class="m">0</span>.5
<span class="o">(</span>...<span class="o">)</span>
./position.23.dat<span class="w"> </span>-9<span class="w"> </span><span class="m">0</span>.5
./position.24.dat<span class="w"> </span>-8.5<span class="w"> </span><span class="m">0</span>.5
</pre></div>
</div>
<div class="justify docutils container">
<p>Then, simply run the following command</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./wham<span class="w"> </span>-20<span class="w"> </span>-8<span class="w"> </span><span class="m">160</span><span class="w"> </span>1e-8<span class="w"> </span><span class="m">300</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>metadata.dat<span class="w"> </span>PMF.dat
</pre></div>
</div>
<div class="justify docutils container">
<p>where -20 and -8 are the boundaries, 160 the number of bins,
1e-8 the tolerance, and 300 the temperature. A file named
PMF.dat has been created, and contains the free energy
profile in Kcal/mol:</p>
</div>
<figure class="align-default">
<img alt="Figure showing the PMF calculated by umbrella sampling" class="only-light" src="../../_images/freeenergy-light.png" />
</figure>
<figure class="align-default" id="id6">
<img alt="Figure showing the PMF calculated by umbrella sampling" class="only-dark" src="../../_images/freeenergy-dark.png" />
<figcaption>
<p><span class="caption-text">Calculated PMF profile normal to the solid wall. The origin <span class="math notranslate nohighlight">\(z=0\)</span>
corresponds to the position of the first layer of atoms.</span><a class="headerlink" href="#id6" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="justify docutils container">
<p>The profile indicates that it is more energetically
favorable for an ethanol molecule to adsorb at the surface
rather than remaining far from it, which is consistent with
what we observe with the unperturbed molecules (they stick
to the surface). The energy well is about 6.5 kcal/mol,
which is about <span class="math notranslate nohighlight">\(11 \times k_\text{B} T\)</span>.</p>
<p>Notice that even at a distance of 1 nm from the wall, the PMF
is not flat, indicating that the ethanol molecule still feels the
presence of the wall. This is expected in vacuum, as there is nothing
in between the molecule and the wall to screen the interaction.</p>
<p>Note that if you intent to publish such PMF,
much longer simulations must be performed.</p>
</div>
<div class="contact docutils container">
<p>Contact me by <a class="reference external" href="mailto:simon&#46;gravelle&#37;&#52;&#48;live&#46;fr">email</a> if you have any question or suggestion about these tutorials.</p>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../reaxff/reax-silica.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Deforming silicon dioxide</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="umbrella-sampling.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Simple free energy calculation</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Adsorption of ethanol</a><ul>
<li><a class="reference internal" href="#download-atb-molecule">Download ATB molecule</a></li>
<li><a class="reference internal" href="#initial-configuration">Initial configuration</a></li>
<li><a class="reference internal" href="#equilibrium">Equilibrium</a></li>
<li><a class="reference internal" href="#umbrella-sampling">Umbrella sampling</a></li>
<li><a class="reference internal" href="#building-the-free-energy-profile">Building the free energy profile</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>